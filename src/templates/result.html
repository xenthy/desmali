<!doctype html>
{% extends "base.html"%}
<html>

<head>
    <title>{% block title %}{% endblock %}</title>
    {% block script %}
    {% endblock%}
</head>

<body>
    {%block content%}
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">Results</h1>
    </div>
    <div class="row">
        <div class="col-xl-6 col-lg-6">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">APK Information</h6>
                </div>
                <div class="card-body">
                    {%for k in stats %}
                    {{k}}: {{stats[k]}}</br>
                    {% endfor %}
                    <!-- <button type="submit" class="btn btn-primary" value="Submit">Download APK</button> -->
                    <a href="/download?q={{stats['name']}}" class="btn btn-primary ">
                        <span class="text">Download APK</span>
                    </a>
                </div>
            </div>
        </div>
    </div>


    <div class="row">
        <div class="col-xl-3 col-lg-3 scroll">
            <div class="card shadow mb-4 ">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">File Tree</h6>
                </div>
                <div class="card-body" style="height:800px; overflow:scroll;">
                    <div id="filetree" class="transparent-effect"></div>
                </div>
            </div>
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.1/jquery.min.js"></script>
        <script src="/static/jsTree/jstree.min.js"></script>
        <script>
            $(function () {

                // 6 create an instance when the DOM is ready
                var d = JSON.parse('{{ data | tojson | safe}}');

                $('#filetree').jstree({
                    'core': {
                        'data': d
                    }
                });

                // 7 bind to events triggered on the tree
                $('#filetree').on("changed.jstree", function (e, data) {
                    //if file , then get text
                    if (data.node.icon == "/static/jsTree/themes/default/file.png") {
                        var d = { 'data': data.selected[0] };
                        //get lines from file
                        $.ajax({
                            type: 'post',
                            url: '/viewlines',
                            contentType: "application/json",
                            data: JSON.stringify(d),
                            success: function (rsp) {
                                document.getElementById("file_output").innerHTML = rsp;
                                document.getElementById("filename").value = data.selected[0];
                            },
                            error: function (XMLHttpRequest, textStatus, errorThrown) {
                                alert("Status: " + textStatus); alert("Error: " + errorThrown);
                            }

                        });

                    }

                });
                // 8 interact with the tree - either way is OK
                $('button').on('click', function () {
                    $('#filetree').jstree(true).select_node('child_node_1');
                    $('#filetree').jstree('select_node', 'child_node_1');
                    $.jstree.reference('#filetree').select_node('child_node_1');
                });

                $('#compareBtn').click(function () {
                    var d = { "data": document.getElementById("filename").value };
                    if (d !== null) {

                        //get html
                        $.ajax({
                            type: 'post',
                            url: '/comparelines',
                            contentType: "application/json",
                            data: JSON.stringify(d),
                            success: function (data) {
                                var w = window.open();
                                w.document.open();
                                w.document.write(data);
                                w.document.close();

                            },
                            error: function (XMLHttpRequest, textStatus, errorThrown) {
                                alert("Status: " + textStatus); alert("Error: " + errorThrown);
                            }
                        });
                    }
                });
            });

        </script>

        <div class="col-xl-9 col-lg-9">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">View File Content</h6>
                    <button id="compareBtn" class="btn btn-primary">Compare changes</button>
                </div>
                <div class="card-body " style="height:782px; overflow:scroll;">
                    <pre id="file_output"></pre>
                </div>
                <input type="hidden" id="filename" value="">
            </div>
            <!-- 
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">Comparison</h6>
                </div>
                <div class="card-body " style="height:500px; overflow:scroll;">
                    <embed id="compare" type="text/html">
                </div>
            </div> -->

        </div>

    </div>

    {% endblock %}

    <script>

    </script>
</body>

</html>